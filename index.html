<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2048 Game</title>
<style>
body{
  margin:0; height:100vh; display:flex; justify-content:center; align-items:center;
  background:#faf8ef; font-family:Arial, sans-serif;
  overflow:hidden; touch-action:none;
}
.game{text-align:center}
h1{color:#776e65; margin:10px 0}
.score-wrap{display:flex; gap:10px; justify-content:center}
.score-box{background:#bbada0; color:#fff; padding:8px 14px; border-radius:6px}
.grid{
  position:relative;
  display:grid;
  grid-template-columns:repeat(4,80px);
  gap:10px;
  background:#bbada0;
  padding:10px;
  border-radius:10px;
}
.cell{
  width:80px; height:80px;
  background:#cdc1b4;
  border-radius:6px;
  display:flex; justify-content:center; align-items:center;
  font-size:36px; font-weight:bold; color:#776e65;
}
.cell[data-value="2"]{background:#eee4da}
.cell[data-value="4"]{background:#ede0c8}
.cell[data-value="8"]{background:#f2b179;color:#f9f6f2}
.cell[data-value="16"]{background:#f59563;color:#f9f6f2}
.cell[data-value="32"]{background:#f67c5f;color:#f9f6f2}
.cell[data-value="64"]{background:#f65e3b;color:#f9f6f2}
.cell[data-value="128"]{background:#edcf72;color:#f9f6f2;font-size:26px}
.cell[data-value="256"]{background:#edcc61;color:#f9f6f2;font-size:26px}
.cell[data-value="512"]{background:#edc850;color:#f9f6f2;font-size:26px}
.cell[data-value="1024"]{background:#edc53f;color:#f9f6f2;font-size:22px}
.cell[data-value="2048"]{background:#edc22e;color:#f9f6f2;font-size:22px}
.cell.merge{animation:pop .18s ease}
@keyframes pop{0%{transform:scale(1)}50%{transform:scale(1.25)}100%{transform:scale(1)}}
.overlay{
  position:absolute; inset:0;
  background:rgba(238,228,218,.85);
  display:none; flex-direction:column;
  justify-content:center; align-items:center;
  font-size:28px; color:#776e65;
}
button{margin-top:10px; padding:8px 16px; font-size:16px; border:0; border-radius:6px; background:#8f7a66; color:#fff}
</style>
</head>
<body>
<div class="game">
<h1>2048</h1>
<div class="score-wrap">
<div class="score-box">Score <span id="score">0</span></div>
<div class="score-box">Best <span id="best">0</span></div>
</div>
<div class="grid" id="grid">
<div class="overlay" id="over">
<div>Game Over</div>
<button id="retry">Retry Now</button>
</div>
</div>
<button id="restart">Retry Now</button>
</div>
<script>
const size=4;
let board=[],score=0,prev=[];
const grid=document.getElementById('grid');
const scoreEl=document.getElementById('score');
const bestEl=document.getElementById('best');
const over=document.getElementById('over');
let best=Number(localStorage.getItem('best2048')||0);
bestEl.textContent=best;

function init(){
  board=Array(16).fill(0); score=0;
  over.style.display='none';
  add(); add(); draw();
}
function add(){
  const e=board.map((v,i)=>v===0?i:null).filter(v=>v!==null);
  if(!e.length)return;
  board[e[Math.floor(Math.random()*e.length)]]=Math.random()<.9?2:4;
}
function draw(){
  grid.querySelectorAll('.cell').forEach(c=>c.remove());
  board.forEach((v,i)=>{
    const d=document.createElement('div'); d.className='cell';
    if(v){ d.textContent=v; d.dataset.value=v; if(prev[i] && prev[i]!==v) d.classList.add('merge'); }
    grid.appendChild(d);
  });
  scoreEl.textContent=score; bestEl.textContent=best;
  if(gameOver()) over.style.display='flex';
}
function slide(r){
  r=r.filter(v=>v);
  for(let i=0;i<r.length-1;i++){
    if(r[i]===r[i+1]){ r[i]*=2; score+=r[i]; r[i+1]=0; }
  }
  r=r.filter(v=>v);
  while(r.length<4) r.push(0);
  return r;
}
function move(d){
  prev=[...board]; const old=board.join();
  if(d==='L')for(let i=0;i<4;i++)board.splice(i*4,4,...slide(board.slice(i*4,i*4+4)));
  if(d==='R')for(let i=0;i<4;i++)board.splice(i*4,4,...slide(board.slice(i*4,i*4+4).reverse()).reverse());
  if(d==='U')for(let c=0;c<4;c++){let col=[];for(let r=0;r<4;r++)col.push(board[r*4+c]);col=slide(col);for(let r=0;r<4;r++)board[r*4+c]=col[r];}
  if(d==='D')for(let c=0;c<4;c++){let col=[];for(let r=3;r>=0;r--)col.push(board[r*4+c]);col=slide(col).reverse();for(let r=0;r<4;r++)board[r*4+c]=col[r];}
  if(old!==board.join()){
    add(); if(score>best){best=score;localStorage.setItem('best2048',best);} draw();
  }
}
function gameOver(){
  if(board.includes(0))return false;
  for(let r=0;r<4;r++)for(let c=0;c<4;c++){
    const i=r*4+c;
    if(c<3&&board[i]===board[i+1])return false;
    if(r<3&&board[i]===board[i+4])return false;
  }
  return true;
}
document.addEventListener('keydown',e=>{
  if(e.key==='ArrowLeft')move('L');
  if(e.key==='ArrowRight')move('R');
  if(e.key==='ArrowUp')move('U');
  if(e.key==='ArrowDown')move('D');
});
let sx,sy;
document.addEventListener('touchstart',e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY},{passive:false});
document.addEventListener('touchend',e=>{
  const dx=e.changedTouches[0].clientX-sx;
  const dy=e.changedTouches[0].clientY-sy;
  if(Math.abs(dx)>Math.abs(dy)) move(dx>0?'R':'L');
  else move(dy>0?'D':'U');
},{passive:false});
document.getElementById('restart').onclick=init;
document.getElementById('retry').onclick=init;
init();
</script>
</body>
</html>
